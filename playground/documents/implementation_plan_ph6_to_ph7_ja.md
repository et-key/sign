# 実装計画: WASM フェーズ 6〜7 (境界演算子と高度なI/O・リスト構築)

## 目標
フェーズ5でリストの展開機能が完成した後、Sign言語とホスト環境（OS/ブラウザ）を繋ぐ「仮想システムコール」を完成させ、さらに仕様書に定義されている高度なリスト構築演算子や単項演算子をWASM上に実装します。

## フェーズ6: 境界演算子と仮想システムコールの完成

### 1. 仮想システムコール (`sys_write`, `sys_read`) の導入
- 現在 `1 #` が直結している `print_float` を廃止し、より低レイヤな `sys_write(fd, ptr, len)` へと移行します。
- これにより、`1 # "Hello"` のような「バッファポインタの直接出力（MMIO）」がWASM上でLinux ABIと同等に機能するようになります。

### 2. ハイブリッドマシン境界演算子 (`$`, `@`)
- **前置 `$` (Address)**: 評価対象が配置されている生のメモリアドレスを、タグ（NaN）を付けずに生の数値（インデックス）として取得する機能を実装します。これによりC言語ライクなハードウェア制御が可能になります。
- **前置 `@` (Input)**: `0 @` によって標準入力から数値を読み取る、または `sys_read` 経由でバッファに書き込む処理を実装します。

## フェーズ7: 高度なリスト構築と未実装演算子

### 1. Range演算子によるリストの動的構築
- `~+` (Step Up), `~-` (Step Down) などのRange演算子を実装します。
- `1 ~+ 5` が評価された際、WASMメモリ上に動的にリスト `1, 2, 3, 4, 5` をアロケートし、その先頭ポインタを返すループ処理をWASM命令として生成します。

### 2. 単項数学演算子の実装
- **絶対値 `|...|`**: パーサには実装済みのため、WASMコンパイラに `f64.abs` 命令を割り当てます。
- **後置演算子 `!` (階乗)**: 引数を受け取り、ループまたは再帰で階乗を計算するネイティブWASMコードを生成します。

## 完了条件
Sign言語の仕様書 (`A_Operator_Table.md`) に記載されているすべての演算子が、WASMコンパイラ上でエラーなくネイティブな動作として完結していること。