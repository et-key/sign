# Sign言語インタープリタ 実装状況

最終更新: 2025-12-03

## 概要

Sign言語のRacket `#lang`実装の開発状況を記録するドキュメントです。

---

## Phase 1: 基本演算と構文解析 ✅ 完了

**完了日**: 2025-12-03

### 実装済み機能

#### コアファイル
- ✅ `info.rkt` - パッケージ情報
- ✅ `main.rkt` - `#lang sign` エントリポイント
- ✅ `reader.rkt` - Sign構文リーダー（トークナイザ + 中置→前置変換）
- ✅ `runtime.rkt` - ランタイムライブラリ
- ✅ `repl.rkt` - 対話環境

#### 演算子
- ✅ **算術**: `+`, `-`, `*`, `/`, `%`, `^`, `!` (階乗)
- ✅ **比較**: `<`, `<=`, `=`, `>=`, `>`, `!=` (値返却型)
- ✅ **論理**: `&` (and), `|` (or), `;` (xor), `!` (not) (短絡評価対応)
- ✅ **定義**: `:` (定義)

#### リテラル
- ✅ 数値: `42`, `-3.14`
- ✅ 16進数: `0xAF`
- ✅ 8進数: `0o77`
- ✅ 2進数: `0b1010`
- ✅ 文字列: `` `文字列` ``
- ✅ Unit: `_`

#### Stream操作
- ✅ 範囲リスト（有限）: `[1 ~ 5]`
- ✅ 範囲リスト（無限）: `[1 ~ ]`
- ✅ 基本的なStream関数（`sign:range`, `sign:range-infinite`）

#### パース機能
- ✅ 中置記法 → S式（前置記法）変換
- ✅ 演算子優先順位の処理
- ✅ 右結合/左結合の対応
- ✅ 文字列・文字の保護機能
- ✅ コメントの除去

#### テスト
- ✅ `tests/test-basic.rkt` - 基本機能のテスト

### 検証状態
- ✅ すべての基本テストがパス
- ✅ REPLが動作
- ✅ ドキュメント整備

---

## Phase 2: 関数定義と適用 ✅ 完了

**完了日**: 2025-12-03

### 実装済み機能

#### ラムダ構築子（`?` 演算子）
- ✅ `x ? x + 1` → 1引数の関数
- ✅ `x y ? x + y` → カリー化された2引数関数
- ✅ `?` 演算子のパース処理（左辺のパラメータリスト化）

#### 関数定義と適用
- ✅ 関数を変数に束縛 (`f : x ? ...`)
- ✅ 関数呼び出し（並置 `f x`）
- ✅ ネストした関数呼び出し (`f (g x)`)
- ✅ 暗黙の関数適用演算子 (`%app`) の自動挿入

#### カリー化対応
- ✅ 複数引数関数の自動カリー化
- ✅ 部分適用のサポート (`add3 : add 3`)

#### ポイントフリー記法
- ✅ `[+ 1]` → `λx. x + 1` (右オペランド固定)
- ✅ `[1 -]` → `λx. 1 - x` (左オペランド固定)
- ✅ 関数合成 (`sign:compose`)

### 技術的詳細
- `reader.rkt`: 中置記法パーサーを拡張し、並置による関数適用とラムダ式のパラメータ解析を実装
- `runtime.rkt`: `sign:?` マクロと部分適用ヘルパーを追加

### テスト
- ✅ `tests/test-functions.rkt` - ラムダ、カリー化、ポイントフリー記法のテスト

---

## Phase 3: リスト操作とStream（✅ 完全実装・仕様準拠）

**最終更新**: 2025-12-04

### 実装済み機能

#### リスト構築
- ✅ カンマ演算子（`,`）によるリスト構築
- ✅ `sign:cons` - リスト要素の追加

#### 範囲リスト
- ✅ 有限範囲リスト: `[1 ~ 5]`
- ✅ 無限範囲リスト: `[1 ~ ]`

#### MAP/FOLD操作
- ✅ MAP操作: `[* 2,] list`
- ✅ FOLD操作: `[+] list`

#### Get演算子
- ✅ インデックスアクセス: `list ' 0`
- ✅ キーアクセス: `obj ' key`

#### 展開演算子
- ✅ Stream→List変換: `list~`

#### リスト結合
- ✅ 並置（空白）によるリスト結合: `list1 list2`
- ✅ 型判定による自動的な動作切り替え（関数適用 vs リスト結合）

### 仕様準拠性

**重要**: 2025-12-03に仕様に存在しない以下の関数を削除し、完全な仕様準拠を達成：
- `sign:list`, `sign:reverse`, `sign:head`, `sign:tail`, `sign:filter`

**2025-12-04**: リスト結合機能を追加し、Phase 3を完全実装。
- `sign:app`関数による型判定で、並置がリスト結合と関数適用を自動判別

現在の実装は、仕様書に完全準拠しています。

### 今後のリファクタリング課題

**注意**: Phase 4実装前に対応すべき設計課題:

現在の実装は動作しますが、Sign言語リファレンスの完全な設計思想には未対応の部分があります：

1. **予約語の排除**: `sign:range`等の明示的関数名を使用（本来は演算子のみ）
2. **括弧の等価性**: `[]`を特殊扱い（本来は`()`と完全等価）
3. **~演算子の完全実装**: 中置・前置・後置の文脈依存パース

これらは**Phase 4実装前の大規模リファクタリング**で対応予定。

### テスト
- ✅ `tests/test-streams.rkt` - Stream操作のテスト（仕様準拠版）
  - リスト結合テストを追加

---

## Phase 4: 制御構造（未着手）

### 予定機能
- 条件分岐（match_case）
- ブロック構文（インデント）
- パターンマッチング

---

## Phase 5: モジュールシステム（未着手）

### 予定機能
- Export演算子（`#`）
- Import機能
- モジュール間の依存関係管理

---

## 技術的な課題・メモ

### 解決済み
- ✅ テスト実行パスの問題（READMEを修正し、実行ディレクトリを明確化）
- ✅ 中置記法から前置記法への変換アルゴリズム（Shunting-yard）

### 現在の課題
- なし

### 今後の課題
- ラムダ式の構文解析における曖昧性の解消
- カリー化と部分適用の効率的な実装
- ポイントフリー記法の文法設計

---

## リファレンス

- **仕様書**: `documents\ja-jp\specification\Interpreter_Specification_ja-jp.md`
- **プロジェクトルート**: `proto\a6\`
- **README**: [README.md](README.md)
