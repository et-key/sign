# プロトタイプ A8 (Sign to S-Expr Converter) 開発状況

現在のバージョン: 0.1.0 (Completed)

## 概要
A8は、Sign言語のソースコードを **S式 (S-expression)** に変換することに特化したプロトタイプです。
コンパイラバックエンドへの入力となる中間表現を生成するために設計されており、実行機能（Interpreter）は持ちません。

## 実装済みの機能

### 1. Lexer (`lexer.js`)
- **トークン化**: 
  - 識別子、数値、文字列、文字リテラル、演算子のトークン化。
  - **空白情報の付与**: 各トークンに `hasPrecedingSpace` フラグを付与し、後続のコンバータで前置/中置/後置の判定に使用。
- **インデント管理**: `INDENT`/`DEDENT` トークンの生成。

### 2. Converter (`converter.js`)
- **アルゴリズム**: Recursive Split by Lowest Precedence（最低優先順位による再帰的分割）。
  - ASTを構築するのではなく、フラットなS式リスト構造を生成します。
- **演算子処理**:
  - **中置**: `x + y` -> `['[+]', 'x', 'y']`
  - **前置**: `!x` -> `['[!_]', 'x']` （密結合）
  - **後置**: `x!` -> `['[_!]', 'x']` （密結合）
  - **Tight Binding**: 空白の有無により `!x` (Tight) と `! x` (Loose) を区別。Tightな演算子は中置よりも優先的に結合します。
- **ポイントフリー記法**:
  - `[+]`: 関数としての演算子参照。
  - `[+ 2]`: セクション（部分適用）。
- **構造化**:
  - **Lambda**: `?` (Precedence 1) は `:` (Precedence 2) より低く、`Match Case` をボディに内包します。
  - **Block**: インデントブロックと `(...)` は等価に処理されます。
  - **Adjacency**: 明示的な演算子がない場合、隣接する要素はフラットなリスト `['f', 'x']` （関数適用）として出力されます。

### 3. Verification
- `run.js`: `example.ja-jp.sn` を変換し、JSONとして出力することを確認済み。
  - 複雑なLambda `x y ? ...` の引数折りたたみを確認。
  - `~` の前置/中置/後置の文脈依存判定を確認。
- `debug_run.js`: 構造的優先順位（`!x + 1` vs `! x + 1`）の正しさを検証済み。

## 制限事項
- **実行不可**: このプロトタイプは変換のみを行います。生成されたS式の意味論的な検証（型チェックなど）は行いません。
- **エラーリカバリ**: パースエラー発生時は例外をスローして停止します（実験的実装のため）。

## 既知の問題
- 特になし（検証フェーズ完了済み）
