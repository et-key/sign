`============================================
` Sign言語 構文解析テストコード
` 基本構文から高度な機能まで段階的にテスト
`============================================

`--------------------------------------------
` 1. 基本リテラル
`--------------------------------------------

`数値リテラル
integer_test : 42
float_test : 3.14159
negative_test : -273.15
hex_test : 0xFF00
oct_test : 0o755
bin_test : 0b1010

`文字・文字列リテラル
char_test : \A
newline_test : \

string_test : `Hello, Sign!`
empty_string : ``

`Unit
unit_test : _

`--------------------------------------------
` 2. 算術演算
`--------------------------------------------

`基本四則演算
add_result : 1 + 2
sub_result : 10 - 3
mul_result : 4 * 5
div_result : 20 / 4
mod_result : 17 % 5

`複合演算（優先順位テスト）
complex1 : 2 + 3 * 4
complex2 : (2 + 3) * 4
power_test : 2 ^ 10
factorial_test : 5!

`絶対値
abs_test : |x - y|

`--------------------------------------------
` 3. 比較演算（値返却型）
`--------------------------------------------

less_test : 3 < 5
equal_test : 5 = 5
range_test : 1 <= x <= 10

`比較多項式
chain_compare : 0 < x = y < 100

`--------------------------------------------
` 4. 論理演算（短絡評価）
`--------------------------------------------

and_test : x > 0 & x < 10
or_test : x < 0 | x > 100
xor_test : flag1 ; flag2
not_test : !condition

`--------------------------------------------
` 5. リスト操作
`--------------------------------------------

`リスト構築
list_explicit : 1, 2, 3, 4, 5
list_implicit : 1 2 3 4 5

`範囲リスト
range_basic : [1 ~ 10]
range_char : [\a ~ \z]
range_step : [1 ~ 3 ~ 10]

`リスト結合
concat_test : [1 2] [3 4]

`リストアクセス
first : [1 2 3] ' 0
last : [1 2 3] ' -1
slice : [1 2 3 4 5] ' [1 ~ 3]

`--------------------------------------------
` 6. 関数定義（ラムダ）
`--------------------------------------------

`単一引数
increment : x ? x + 1

`複数引数（カリー化）
add : x y ? x + y

`ブロック構文
abs : x ?
	x >= 0 : x
	x < 0 : -x

`無名関数
apply_anon : [x ? x * 2] 5

`--------------------------------------------
` 7. ポイントフリー記法
`--------------------------------------------

`部分適用
add_one : [+ 1]
double : [* 2]

`演算子の関数化
sum : [+]
product : [*]

`MAP演算
double_list : [* 2,] [1 2 3 4 5]

`FOLD演算
sum_list : [+] [1 ~ 10]

`--------------------------------------------
` 8. 高階関数
`--------------------------------------------

`map実装
map : f x ~y ? @f x, map f y~

`filter実装
filter : pred x ~y ?
	@pred x : x, filter pred y~
	filter pred y~

`fold実装
fold : f acc x ~y ? fold f (@f acc x) y~

`関数合成
compose : f g x ? @f @g x

`--------------------------------------------
` 9. パターンマッチング（match_case）
`--------------------------------------------

`基本的な条件分岐
classify : x ?
	x < 0 : `negative`
	x = 0 : `zero`
	x > 0 : `positive`

`範囲判定
grade : score ?
	score >= 90 : `A`
	score >= 80 : `B`
	score >= 70 : `C`
	score >= 60 : `D`
	`F`

`複雑な条件
access_check : user role ?
	user = `admin` : `full_access`
	role = `moderator` & user != `guest` : `moderate_access`
	user != _ : `basic_access`
	`no_access`

`--------------------------------------------
` 10. 辞書型・構造体
`--------------------------------------------

`辞書定義
person :
	name : `Alice`
	age : 30
	skills : `coding`, `design`, `testing`

`get演算子
get_name : person ' name
get_age : 0 @ age @ person

`値の更新
updated_person : person
	' name : `Bob`
	' age : 25

`--------------------------------------------
` 11. 連続引数（~前置）とスプレッド（~後置）
`--------------------------------------------

`可変長引数
sum_all : ~nums ? [+] nums

`引数展開
args : 1, 2, 3, 4, 5
result : sum_all args~

`head/tail分離
head : x ~_ ? x
tail : _ ~rest ? rest

`--------------------------------------------
` 12. 定義とエクスポート
`--------------------------------------------

`ローカル定義
local_value : 42
local_func : x ? x * 2

`エクスポート定義
#exported_value : 100
#exported_func : x y ? x + y

`--------------------------------------------
` 13. ブロック構文の階層
`--------------------------------------------

`インデントブロック
process_data : x ?
	validated : validate x
	normalized : normalize validated
	processed : transform normalized
	finalize processed

`ネストしたブロック
nested_logic : x y ?
	x > 0 :
		y > 0 : `both_positive`
		y < 0 : `x_pos_y_neg`
		`x_pos_y_zero`
	x < 0 :
		y > 0 : `x_neg_y_pos`
		y < 0 : `both_negative`
		`x_neg_y_zero`
	`at_least_one_zero`

`--------------------------------------------
` 14. 関数合成とパイプライン
`--------------------------------------------

`左から右へのデータフロー
pipeline : [> 0,] [* 2,] [+]

`使用例
result : pipeline [-2 -1 0 1 2 3]

`関数の連鎖
transform : [+ 1] [* 2] [^ 2]
apply_transform : transform 5

`--------------------------------------------
` 15. 再帰
`--------------------------------------------

`階乗（再帰）
factorial : n ?
	n <= 1 : 1
	n * factorial (n - 1)

`フィボナッチ
fibonacci : n ?
	n <= 1 : n
	fibonacci (n - 1) + fibonacci (n - 2)

`リスト逆転
reverse : x ~y ?
	y = _ : x
	reverse y~, x

`--------------------------------------------
` 16. 複雑な実用例
`--------------------------------------------

`クイックソート
quicksort : x ~xs ?
	xs = _ : x
	smaller : filter [< x,] xs
	larger : filter [>= x,] xs
	quicksort smaller~, x, quicksort larger~

`畳み込みを使った合計
sum_range : start end ?
	[+] [start ~ end]

`条件付きマッピング
conditional_map : pred transform x ~xs ?
	@pred x : @transform x, conditional_map pred transform xs~
	x, conditional_map pred transform xs~

`--------------------------------------------
` 17. エラーケース（コメント化）
`--------------------------------------------

`これらは構文エラーになるべき例

`missing_colon x ? x + 1
`unmatched_bracket : [1 2 3
`invalid_operator : x $ y
`double_space_in_infix : x  +  y

`--------------------------------------------
` テスト実行用メイン関数
`--------------------------------------------

#main :
	`基本リテラル
	integer_test
	float_test
	
	`算術演算
	add_result
	complex1
	
	`リスト操作
	list_explicit
	range_basic
	
	`関数適用
	increment 5
	add 3 5
	
	`高階関数
	double_list
	sum_list
	
	`完了
	`All tests completed`

